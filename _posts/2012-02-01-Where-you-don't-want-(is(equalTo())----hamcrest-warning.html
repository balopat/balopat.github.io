---           
layout: post
title: Where you don't want (is(equalTo()) -- hamcrest warning
date: 2012-02-01 19:55:00 UTC
updated: 2013-12-14 19:44:55 UTC
comments: false
categories: clean code hamcrest refactoring tdd
---

<p> this post was imported and exported at least twice, and hasn't been polished up yet. bear with me, thank you for your patience </p>
 
<p>It is quite easy to get used to the<a href="http://code.google.com/p/hamcrest/wiki/Tutorial" target="_self"> Hamcrest notation</a>&#0160;but - like everywhere where software turns up -&#0160;&#0160;you just can&#39;t avoid actual <strong>thinking; </strong>and most importantly&#0160;<strong>understanding the tool</strong> you are using. This is a small &quot;one-liner&quot; about where you don&#39;t want to use the very nice<em> assertThat(actualValue, is(equalTo(expectedValue))) </em>or it&#39;s shorter (even more nicer in most cases) version: <em>assertThat(actualValue, is(expectedValue))</em>.</p><br /><br/><br/><p>The small thing I encountered today was that Cobertura failed after my eager-beaver (boy-scout) refactorings on a test class saying &quot;hey mate, your branch coverage is way below the expected 100%, it&#39;s 75%, what the hell did you think?!&quot;.&#0160;</p><br /><h2><strong>Good intention</strong></h2><br /><p>I just wanted to do an equivalent refactoring to make it readable, seemingly it did not turn out to be equivalent enough.</p><br /><p>Earlier it was:</p><br /><p><em>assertFalse(actualWha&#39;ever.equals(new Object()));</em></p><br /><p>Now. &quot;let&#39;s assert false actual stuff equals new Object&quot;.&#0160;Who says that?!</p><br /><p>You had to read it twice hadn&#39;t you? Because it is not English.&#0160;We usually say &quot;let&#39;s assert actual stuff is not equal to a different object&quot; don&#39;t we?&#0160;</p><br /><p>So,&#0160;I thought Hamcrest should come to the rescue.&#0160;</p><br /><p><em>Object aDifferentObject = new Object();</em></p><br /><p><em>assertThat(actualWha&#39;ever, is(not(aDifferentObject))));</em></p><br /><p><strong>Beautiful</strong>. But in spite of the beauty:<strong>&#0160;caboom</strong>! Our bloody Cobertura build (sometimes I hate automated tests, because they&#39;re right!) fails with Wha&#39;ever class branch coverage dropped below 100%!!!</p><br /><h2><strong>The problem&#0160;</strong></h2><br /><p>What happened? The point is that actually<strong> we were testing the equals method </strong>on the Wha&#39;ever class!&#0160;</p><br /><p>Why is it a problem? Two reasons:</p><br /><ol><br /><li>Because the Is&lt;T&gt;.is is using null safe logic ---&gt; i.e. your null comparison code will never get executed&#0160;</li><br /><li>assertThat(<em>actual</em>, is(equalTo(expected)) ) uses the<strong><span style="color: #c00000;"> expected</span>.equals</strong> method <strong>and not</strong> what you&#39;d expect it to do: <strong>&#0160;actual</strong>.<strong>equals</strong></li><br /></ol><br /><h2>Lesson learned</h2><br /><p>When you are testing a method, think about the method, do not use something &quot;similar&quot; and assume that it will call it, even if it is temptingly expressive like Hamcrest. Use the method itself instead.</p><br /><p>I did leave the aDifferentObject variable name there though ;)&#0160;</p><br /><p>&#0160;So the clumsy end result is:&#0160;</p><br /><p><em>assertFalse(actualWha&#39;ever.equals(aDifferentObject));</em></p><br /><p>&#0160;</p><br /><p>&#0160;</p><br /><p>&#0160;</p><br /><p>&#0160;</p><br /><p>&#0160;</p><br />